name: ðŸ§ª Multi-Language Testing

on:
  pull_request:
    branches: [ main ]
    paths:
      - 'challenges/**'
      - 'projects/**'

permissions:
  contents: read

jobs:
  detect-changes:
    runs-on: ubuntu-latest
    outputs:
      python: ${{ steps.filter.outputs.python }}
      javascript: ${{ steps.filter.outputs.javascript }}
      java: ${{ steps.filter.outputs.java }}
      go: ${{ steps.filter.outputs.go }}
      cpp: ${{ steps.filter.outputs.cpp }}
    steps:
      - uses: actions/checkout@v4
      - uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            python:
              - '**/*.py'
            javascript:
              - '**/*.js'
            java:
              - '**/*.java'
            go:
              - '**/*.go'
            cpp:
              - '**/*.cpp'
              - '**/*.h'

  test-python:
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.python == 'true'

    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: pip install pytest flake8
      - name: Lint with flake8
        run: flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
      - name: Test with pytest
        run: pytest challenges/ projects/ -v

  test-javascript:
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.javascript == 'true'

    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm install
      - name: Lint with ESLint
        run: npx eslint challenges/ projects/ --ext .js
      - name: Test with Jest
        run: npm test

  test-java:
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.java == 'true'

    steps:
      - uses: actions/checkout@v4
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
      - name: Compile and Test
        run: |
          find challenges/ projects/ -name "*.java" -exec javac {} \;
          find challenges/ projects/ -name "*Test.java" -exec java -cp . {} \;

  test-go:
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.go == 'true'

    steps:
      - uses: actions/checkout@v4
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      - name: Test
        run: go test ./challenges/... ./projects/...

  test-cpp:
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.cpp == 'true'

    steps:
      - uses: actions/checkout@v4
      - name: Setup CMake
        uses: lukka/get-cmake@latest
      - name: Configure and Build
        run: |
          mkdir build && cd build
          cmake ..
          make
      - name: Test
        run: cd build && ctest
