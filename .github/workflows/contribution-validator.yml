name: üöÄ Contribution Validator

on:
  pull_request:
    branches: [ main ]
    paths:
      - 'profiles/**'
      - 'challenges/**'
      - 'projects/**'
      - 'scripts/**'
  push:
    branches: [ main ]

permissions:
  contents: read
  pull-requests: write

jobs:
  validate-contribution:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v4

    - name: üêç Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'

    - name: üì¶ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyyaml requests Pillow

    - name: üîç Validate Markdown files
      uses: gaurav-nelson/github-action-markdown-link-check@v1
      continue-on-error: true
      with:
        use-quiet-mode: 'yes'
        config-file: '.github/workflows/markdown-link-check-config.json'

    - name: üß™ Run existing validation scripts
      run: |
        # Only run scripts that exist
        if [ -f "scripts/validate_contributions.py" ]; then
          python scripts/validate_contributions.py || echo "Validation completed with warnings"
        fi

        if [ -f "scripts/generate_badges.py" ]; then
          python scripts/generate_badges.py || echo "Badge generation completed with warnings"
        fi

    - name: ‚úÖ Validate file structure
      run: |
        # Check that profile files are in correct location
        if ls profiles/*.md >/dev/null 2>&1; then
          echo "‚úì Profile files found"
          for file in profiles/*.md; do
            if [ -f "$file" ]; then
              echo "  ‚úì $file"
            fi
          done
        fi

        # Check challenge structure
        if [ -d "challenges" ]; then
          echo "‚úì Challenges directory exists"
        fi

        # Check projects structure
        if [ -d "projects" ]; then
          echo "‚úì Projects directory exists"
        fi

  auto-label:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'

    steps:
      - name: üè∑Ô∏è Auto-label based on files changed
        uses: actions/labeler@v5
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          configuration-path: .github/labeler.yml
          sync-labels: true

